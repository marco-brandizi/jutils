<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Thu Mar 14 23:54:19 UTC 2024 -->
<title>BatchProcessor (JUtils - Miscellanea of Java Utils 14.1-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2024-03-14">
<meta name="description" content="declaration: package: uk.ac.ebi.utils.threading.batchproc, class: BatchProcessor">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/BatchProcessor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">uk.ac.ebi.utils.threading.batchproc</a></div>
<h1 title="Class BatchProcessor" class="title">Class BatchProcessor&lt;B,<wbr>BC extends <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc">BatchCollector</a>&lt;B&gt;,<wbr>BJ extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Consumer.html" title="class or interface in java.util.function" class="external-link">Consumer</a>&lt;B&gt;&gt;</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">uk.ac.ebi.utils.threading.batchproc.BatchProcessor&lt;B,<wbr>BC,<wbr>BJ&gt;</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>Type Parameters:</dt>
<dd><code>B</code> - the type of batch to be handled</dd>
<dd><code>BC</code> - the type of <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>BatchCollector</code></a> to use for batch operations</dd>
<dd><code>BJ</code> - the type of job that is able to process a batch of type `B`</dd>
</dl>
<dl class="notes">
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="ItemizedBatchProcessor.html" title="class in uk.ac.ebi.utils.threading.batchproc">ItemizedBatchProcessor</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Deprecated.html" title="class or interface in java.lang" class="external-link">@Deprecated</a>
</span><span class="modifiers">public abstract class </span><span class="element-name type-name-label">BatchProcessor&lt;B,<wbr>BC extends <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc">BatchCollector</a>&lt;B&gt;,<wbr>BJ extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Consumer.html" title="class or interface in java.util.function" class="external-link">Consumer</a>&lt;B&gt;&gt;</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span>
<div class="deprecation-comment">the functionality available in this package is provided by project 
 Reactor and we recommend to switch to that. TODO: helpers and examples about batching via Reactor.</div>
</div>
<div class="block"><h1>Batch Processor Skeleton</h1> 
 
 A simple skeleton to manage processing of data in multi-thread mode.  
 
 The idea for which this class and <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>batch collectors</code></a> provide scaffolding for
 is that a data source is used to build `B` batches and, when 
 <a href="BatchCollector.html#batchReadyFlag()"><code>a batch is ready to be processed</code></a>, it is submitted to a `BJ`
 job and run in parallel by an <a href="#getExecutor()"><code>getExecutor()</code></a>.   
 
 This class is just a skeleton, for a concrete implementation you need to realise the above source
 processing loop on your own. In order to facilitate that, <a href="#handleNewBatch(B,boolean)"><code>handleNewBatch(Object, boolean)</code></a>
 is provided. You should call it periodically, and it checks if the current batch (that you're filling)
 is ready for submission and, if yes, it submits the current batch to a new parallel job, 
 <a href="BatchCollector.html#batchFactory()"><code>creates a new batch</code></a> and returns it (normally it returns the current
 batch).  
 
 At the end of such a loop, you should call <a href="#waitExecutor(java.lang.String)"><code>waitExecutor(String)</code></a>, so that the final batch you were building
 is forced into processing and other close-up operations are performed.  
 
 As you can see above, <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>BatchCollector</code></a> is another facility to manage batch creation and decide if a
 batch is ready to be processed.   
 
 Specific implementations are provided for both <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>BatchCollector</code></a> and this processor class.
 For instance, We have an <a href="ItemizedBatchProcessor.html" title="class in uk.ac.ebi.utils.threading.batchproc"><code>item-based processor</code></a>, which 
 <code>implements</code> the above-described source dispatching loop
 as the fetch from a stream of items, which are sent to batches.  
 
 This specific processor uses <a href="ItemizedSizedBatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>item-based collectors</code></a>, which of default implementation
 decides if a batch is ready to go on the basis of the <a href="SizedBatchCollector.html#batchSizer()"><code>number of items</code></a>
 it has. Other specific processors are those <a href="processors/CollectionBasedBatchProcessor.html" title="class in uk.ac.ebi.utils.threading.batchproc.processors"><code>based on Java collections</code></a>, which 
 makes use of corresponding <a href="collectors/CollectionBatchCollector.html" title="class in uk.ac.ebi.utils.threading.batchproc.collectors"><code>CollectionBatchCollector</code></a>.  
 
 Note that, while we consider sychronisation issues for the <a href="#getBatchJob()"><code>batch processing jobs</code></a>, we assume that
 the initialisation and submission operations are run by a single thread (eg, `main`), so the code about that isn't 
 thread-safe. For instance, <a href="#waitExecutor(java.lang.String)"><code>waitExecutor(String)</code></a> won't synchronise over the <a href="#getExecutor()"><code>current executor</code></a>
 and <a href="#setBatchJob(BJ)"><code>setBatchJob(Consumer)</code></a> won't synchronise over the current job. Instantiating multiple processors is a 
 safe way to deal with such a multi-multi-thread scenario. Likely, you'll want to share the executor job in such a case.</div>
<dl class="notes">
<dt>Author:</dt>
<dd>brandizi
 <dl><dt>Date:</dt><dd>1 Dec 2017</dd></dl></dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected long</code></div>
<div class="col-second even-row-color"><code><a href="#jobLogPeriod" class="member-name-link">jobLogPeriod</a></code></div>
<div class="col-last even-row-color">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first odd-row-color"><code>protected org.slf4j.Logger</code></div>
<div class="col-second odd-row-color"><code><a href="#log" class="member-name-link">log</a></code></div>
<div class="col-last odd-row-color">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">BatchProcessor</a>()</code></div>
<div class="col-last even-row-color">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(BJ)" class="member-name-link">BatchProcessor</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob)</code></div>
<div class="col-last odd-row-color">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(BJ,BC)" class="member-name-link">BatchProcessor</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob,
 <a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a>&nbsp;batchCollector)</code></div>
<div class="col-last even-row-color">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button><button id="method-summary-table-tab6" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab6', 3)" class="table-tab">Deprecated Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#getBatchCollector()" class="member-name-link">getBatchCollector</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">As explained in <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>BatchCollector</code></a>, this is used to create a new batch and decide if it's ready for submission
 to a new <a href="#getBatchJob()"><code>job</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#getBatchJob()" class="member-name-link">getBatchJob</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block"><a href="#handleNewBatch(B,boolean)"><code>handleNewBatch(Object, boolean)</code></a> launches this job every time the current batch being considered is 
 <a href="BatchCollector.html#batchReadyFlag()"><code>ready for processing</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#getCompletedBatches()" class="member-name-link">getCompletedBatches</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#getExecutor()" class="member-name-link">getExecutor</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">The executor service used by <a href="#handleNewBatch(B)"><code>handleNewBatch(Object)</code></a> to submit <a href="#getBatchJob()"><code>batch jobs and 
 run them in parallel</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#getSubmittedBatches()" class="member-name-link">getSubmittedBatches</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected <a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#handleNewBatch(B)" class="member-name-link">handleNewBatch</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a>&nbsp;currentBatch)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected <a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#handleNewBatch(B,boolean)" class="member-name-link">handleNewBatch</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a>&nbsp;currentBatch,
 boolean&nbsp;forceFlush)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">This is the method that possibly issues a new task, via the <a href="#getExecutor()"><code>getExecutor()</code></a>, which runs 
 the <a href="#getBatchJob()"><code>getBatchJob()</code></a> against the current batch.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#setBatchCollector(BC)" class="member-name-link">setBatchCollector</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a>&nbsp;batchCollector)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#setBatchJob(BJ)" class="member-name-link">setBatchJob</a><wbr>(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#setExecutor(java.util.concurrent.ExecutorService)" class="member-name-link">setExecutor</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a>&nbsp;executor)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#setJobLogPeriod(long)" class="member-name-link">setJobLogPeriod</a><wbr>(long&nbsp;jobLogPeriod)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">If &gt; 0, methods like <a href="#handleNewBatch(B,boolean)"><code>handleNewBatch(Object, boolean)</code></a> and <a href="#waitExecutor(java.lang.String)"><code>waitExecutor(String)</code></a> log messages 
 about how many submitted and completed <a href="#getBatchJob()"><code>jobs</code></a> the processor is dealing with, and does it every
 a number of submitted jobs equal to this property.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#waitExecutor(java.lang.String)" class="member-name-link">waitExecutor</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pleaseWaitMessage)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">Waits that all the parallel jobs submitted to the batchJob are finished.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#wrapBatchJob(java.lang.Runnable)" class="member-name-link">wrapBatchJob</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;batchJob)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">Wraps the task into some common operations.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="jobLogPeriod">
<h3>jobLogPeriod</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">jobLogPeriod</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="log">
<h3>log</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">org.slf4j.Logger</span>&nbsp;<span class="element-name">log</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(BJ,BC)">
<h3 id="&lt;init&gt;(java.util.function.Consumer,uk.ac.ebi.utils.threading.batchproc.BatchCollector)">BatchProcessor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">BatchProcessor</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob,
 <a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a>&nbsp;batchCollector)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(BJ)">
<h3 id="&lt;init&gt;(java.util.function.Consumer)">BatchProcessor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">BatchProcessor</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>BatchProcessor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">BatchProcessor</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="handleNewBatch(B)">
<h3 id="handleNewBatch(java.lang.Object)">handleNewBatch</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a></span>&nbsp;<span class="element-name">handleNewBatch</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a>&nbsp;currentBatch)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="handleNewBatch(B,boolean)">
<h3 id="handleNewBatch(java.lang.Object,boolean)">handleNewBatch</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a></span>&nbsp;<span class="element-name">handleNewBatch</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">B</a>&nbsp;currentBatch,
 boolean&nbsp;forceFlush)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">This is the method that possibly issues a new task, via the <a href="#getExecutor()"><code>getExecutor()</code></a>, which runs 
 the <a href="#getBatchJob()"><code>getBatchJob()</code></a> against the current batch. 
 
 Note that the batch job will be executed under the <a href="#wrapBatchJob(java.lang.Runnable)"><code>default wrapper</code></a>.  
 
 This method also resets the internal <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService</code></a>, which will be recreated (once) upon the first 
 invocation of <a href="#getExecutor()"><code>getExecutor()</code></a>. This behaviour ensures that a processor can be invoked multiple times 
 reusing the same batchJob instance (normally that's not possible for an <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService</code></a> after its 
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html#awaitTermination(long,java.util.concurrent.TimeUnit)" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService.awaitTermination(long, TimeUnit)</code></a> method is called).</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>forceFlush</code> - if true it flushes the data independently of <a href="BatchCollector.html#batchReadyFlag()"><code>BatchCollector.batchReadyFlag()</code></a>. Which is
 typically needed when you've exhausted a stream of data and you have a last partially-filled batch to process.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getBatchCollector()">
<h3>getBatchCollector</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a></span>&nbsp;<span class="element-name">getBatchCollector</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">As explained in <a href="BatchCollector.html" title="interface in uk.ac.ebi.utils.threading.batchproc"><code>BatchCollector</code></a>, this is used to create a new batch and decide if it's ready for submission
 to a new <a href="#getBatchJob()"><code>job</code></a>.</div>
<dl class="notes">
<dt>Returns:</dt>
</dl>
</section>
</li>
<li>
<section class="detail" id="setBatchCollector(BC)">
<h3 id="setBatchCollector(uk.ac.ebi.utils.threading.batchproc.BatchCollector)">setBatchCollector</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setBatchCollector</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BC</a>&nbsp;batchCollector)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="getBatchJob()">
<h3>getBatchJob</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a></span>&nbsp;<span class="element-name">getBatchJob</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block"><a href="#handleNewBatch(B,boolean)"><code>handleNewBatch(Object, boolean)</code></a> launches this job every time the current batch being considered is 
 <a href="BatchCollector.html#batchReadyFlag()"><code>ready for processing</code></a>.  
 
 Note that your job is wrapped into <a href="#wrapBatchJob(java.lang.Runnable)"><code>wrapBatchJob(Runnable)</code></a>.</div>
</section>
</li>
<li>
<section class="detail" id="setBatchJob(BJ)">
<h3 id="setBatchJob(java.util.function.Consumer)">setBatchJob</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setBatchJob</span><wbr><span class="parameters">(<a href="BatchProcessor.html" title="type parameter in BatchProcessor">BJ</a>&nbsp;batchJob)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="getExecutor()">
<h3>getExecutor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a></span>&nbsp;<span class="element-name">getExecutor</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">The executor service used by <a href="#handleNewBatch(B)"><code>handleNewBatch(Object)</code></a> to submit <a href="#getBatchJob()"><code>batch jobs and 
 run them in parallel</code></a>.   
 
 By default this is <a href="../HackedBlockingQueue.html#createExecutor()"><code>HackedBlockingQueue.createExecutor()</code></a>, ie, a fixed size executor
 pool, which is able to block and wait when it's full. Moreover, such executor is equipped with a convenient 
 <a href="../ThreadUtils.html#setNamingThreadFactory(java.lang.Class,java.util.concurrent.ThreadPoolExecutor)"><code>naming thread factory</code></a>, which names the 
 threads based on the processor class (ie, myself or one extension of mine).     
 
 Normally you shouldn't need to change this parameter, unless you want some particular execution policy. A 
 situation where you want to use the <a href="#setExecutor(java.util.concurrent.ExecutorService)"><code>setter for this property</code></a> is when 
 you want to hook multiple batch processors to the same executor, to avoid recreating threads too many times, and/or
 to decide an overall thread management policy.</div>
</section>
</li>
<li>
<section class="detail" id="setExecutor(java.util.concurrent.ExecutorService)">
<h3>setExecutor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setExecutor</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a>&nbsp;executor)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="waitExecutor(java.lang.String)">
<h3>waitExecutor</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">waitExecutor</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pleaseWaitMessage)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block"><p>Waits that all the parallel jobs submitted to the batchJob are finished. It keeps polling
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html#isTerminated()" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService.isTerminated()</code></a> and invoking <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html#awaitTermination(long,java.util.concurrent.TimeUnit)" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService.awaitTermination(long, TimeUnit)</code></a>.</p>
 
 <p>As explained above, this resets the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ExecutorService</code></a> that is returned by <a href="#getExecutor()"><code>getExecutor()</code></a>, so that
 the next time that method is invoked, it will get a new executor from <code>#getExecutorFactory()</code>.</p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pleaseWaitMessage</code> - the message to be reported (via logger/INFO level) while waiting.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="wrapBatchJob(java.lang.Runnable)">
<h3>wrapBatchJob</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a></span>&nbsp;<span class="element-name">wrapBatchJob</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;batchJob)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">Wraps the task into some common operations. At the moment,
 
   * wraps exception,
   * logs the progress of completed tasks every <a href="#jobLogPeriod"><code>jobLogPeriod</code></a> completed tasks.</div>
</section>
</li>
<li>
<section class="detail" id="getSubmittedBatches()">
<h3>getSubmittedBatches</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getSubmittedBatches</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="getCompletedBatches()">
<h3>getCompletedBatches</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getCompletedBatches</span>()</div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
</section>
</li>
<li>
<section class="detail" id="setJobLogPeriod(long)">
<h3>setJobLogPeriod</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setJobLogPeriod</span><wbr><span class="parameters">(long&nbsp;jobLogPeriod)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span></div>
<div class="block">If &gt; 0, methods like <a href="#handleNewBatch(B,boolean)"><code>handleNewBatch(Object, boolean)</code></a> and <a href="#waitExecutor(java.lang.String)"><code>waitExecutor(String)</code></a> log messages 
 about how many submitted and completed <a href="#getBatchJob()"><code>jobs</code></a> the processor is dealing with, and does it every
 a number of submitted jobs equal to this property. Additionally, <a href="#waitExecutor(java.lang.String)"><code>waitExecutor(String)</code></a> logs the parameter it
 receives.  
 
 If it's 0, just does the latter.  
 
 If it's -1, none of such logging happens.  
 
 It might be useful to disable these messages with 0 or -1 if the caller wants to use its own logging about similar
 events. In particular, it might be useful when you use mukltiple processors in parallel, or the same for multiple
 times.
 
 **WARNING**: implementors of this class's subclasses should comply with the above semantics for this parameter, at 
 least if those classes are general purpose and meant to be reused by third parties.</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2024. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
